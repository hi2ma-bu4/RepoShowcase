var h=class n{root={children:new Map};buffer=[];maxSequenceLength=0;pressedKeys=new Set;isLastKeyDown=!1;aliasMap=new Map;target;static STANDARD_KEY_MAP={esc:"escape",del:"delete",return:"enter",left:"arrowleft",right:"arrowright",up:"arrowup",down:"arrowdown"," ":"space",ctrl:"control",cmd:"meta",windows:"meta"};constructor(i){this.target=i??window,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.target.addEventListener("keydown",this.handleKeyDown,!0),this.target.addEventListener("keyup",this.handleKeyUp,!0)}addAlias(i,t){this.aliasMap.set(i.toLowerCase(),t.map(e=>e.toLowerCase()))}register(i,t,e){if(!i.length)return;this.maxSequenceLength=Math.max(this.maxSequenceLength,i.length);let o=this.root;for(let s of i){let r=new Set(Array.isArray(s)?s:[s]),a=n.setToKey(this.normalizeCombo(r));o.children.has(a)||o.children.set(a,{children:new Map}),o=o.children.get(a)}o.callback=t,o.options=e}unregister(i){if(!i.length)return;let t=[],e=this.root;for(let o of i){let s=new Set(Array.isArray(o)?o:[o]),r=n.setToKey(this.normalizeCombo(s));if(!e.children.has(r))return;e=e.children.get(r),t.push(e)}e&&(e.callback=void 0,e.options=void 0);for(let o=t.length-1;o>=0;o--){let s=o>0?t[o-1]:this.root,r=Array.from(t[o].children.keys())[0];t[o].callback===void 0&&t[o].children.size===0&&s.children.delete(r)}}normalizeCombo(i){let t=new Set;for(let e of i){e=(n.STANDARD_KEY_MAP[e]??e).toLowerCase();let o=!1;for(let[s,r]of this.aliasMap)if(r.includes(e)){t.add(s),o=!0;break}o||t.add(e)}return t}static setToKey(i){return Array.from(i).sort().join("+")}handleKeyDown(i){let t=(n.STANDARD_KEY_MAP[i.key]??i.key).toLowerCase();this.pressedKeys.has(t)||(this.pressedKeys.add(t),this.isLastKeyDown=!0)}handleKeyUp(i){let t=(n.STANDARD_KEY_MAP[i.key]??i.key).toLowerCase();if(this.pressedKeys.has(t)&&this.isLastKeyDown){this.isLastKeyDown=!1;let e=new Set(this.pressedKeys);this.buffer.push(this.normalizeCombo(e)),this.buffer.length>this.maxSequenceLength&&this.buffer.shift(),this.checkBuffer()}this.pressedKeys.delete(t)}checkBuffer(){if(!this.buffer.length)return;let i=[];for(let t=0;t<this.buffer.length;t++){if(i[t])continue;let e=this.root,o=!0;for(let s=t;s<this.buffer.length;s++){let r=n.setToKey(this.buffer[s]);if(!e.children.has(r)){o=!1;break}e=e.children.get(r)}if(o&&e.callback&&(e.callback(),e.options?.once&&(e.callback=void 0,e.options=void 0),e.options?.stopOthers))for(let s=t+1;s<this.buffer.length;s++)i[s]=!0}}destroy(){this.target.removeEventListener("keydown",this.handleKeyDown,!0),this.target.removeEventListener("keyup",this.handleKeyUp,!0),this.buffer=[],this.root={children:new Map},this.pressedKeys.clear(),this.isLastKeyDown=!1,this.aliasMap.clear(),this.maxSequenceLength=0}};typeof window<"u"&&(window.FlowKeys=h);export{h as FlowKeys};
//# sourceMappingURL=FlowKeys.min.js.map
