var n=class i{root={children:new Map};buffer=[];maxSequenceLength=0;pressedKeys=new Set;isLastKeyDown=!1;aliasMap=new Map;target;static STANDARD_KEY_MAP={esc:"escape",del:"delete",return:"enter",left:"arrowleft",right:"arrowright",up:"arrowup",down:"arrowdown"," ":"space",ctrl:"control",cmd:"meta",windows:"meta"};constructor(e){this.target=e??window,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.target.addEventListener("keydown",this.handleKeyDown,!0),this.target.addEventListener("keyup",this.handleKeyUp,!0)}addAlias(e,t){this.aliasMap.set(e.toLowerCase(),t.map(s=>s.toLowerCase()))}register(e,t){if(!e.length)return;this.maxSequenceLength=Math.max(this.maxSequenceLength,e.length);let s=this.root;for(let a of e){let r=new Set(Array.isArray(a)?a:[a]),o=i.setToKey(this.normalizeCombo(r));s.children.has(o)||s.children.set(o,{children:new Map}),s=s.children.get(o)}s.callback=t}normalizeCombo(e){let t=new Set;for(let s of e){s=(i.STANDARD_KEY_MAP[s]??s).toLowerCase();let a=!1;for(let[r,o]of this.aliasMap)if(o.includes(s)){t.add(r),a=!0;break}a||t.add(s)}return t}static setToKey(e){return Array.from(e).sort().join("+")}handleKeyDown(e){let t=(i.STANDARD_KEY_MAP[e.key]??e.key).toLowerCase();this.pressedKeys.has(t)||(this.pressedKeys.add(t),this.isLastKeyDown=!0)}handleKeyUp(e){let t=(i.STANDARD_KEY_MAP[e.key]??e.key).toLowerCase();if(this.pressedKeys.has(t)&&this.isLastKeyDown){this.isLastKeyDown=!1;let s=new Set(this.pressedKeys);this.buffer.push(this.normalizeCombo(s)),this.buffer.length>this.maxSequenceLength&&this.buffer.shift(),this.checkBuffer()}this.pressedKeys.delete(t)}checkBuffer(){if(this.buffer.length)for(let e=0;e<this.buffer.length;e++){let t=this.root,s=!0;for(let a=e;a<this.buffer.length;a++){let r=i.setToKey(this.buffer[a]);if(!t.children.has(r)){s=!1;break}t=t.children.get(r)}s&&t.callback&&t.callback()}}destroy(){this.target.removeEventListener("keydown",this.handleKeyDown,!0),this.target.removeEventListener("keyup",this.handleKeyUp,!0),this.buffer=[],this.root={children:new Map},this.pressedKeys.clear(),this.isLastKeyDown=!1,this.aliasMap.clear(),this.maxSequenceLength=0}};typeof window<"u"&&(window.FlowKeys=n);export{n as FlowKeys};
//# sourceMappingURL=FlowKeys.min.js.map
