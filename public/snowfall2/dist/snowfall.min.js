/*!
 * SnowFall2 v0.3.1
 * Copyright 2026 hi2ma-bu4
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var j=Object.defineProperty;var C=(t,e)=>{for(var n in e)j(t,n,{get:e[n],enumerable:!0})};var v={};C(v,{WasmCompileResult:()=>w,compile:()=>N,default:()=>E,free_memory:()=>B,free_memory_with_len:()=>U,initSync:()=>K,lexer:()=>L,main_init:()=>q,normalize:()=>X,parser:()=>Y,version:()=>H});var i;function D(t){let e=i.__externref_table_alloc();return i.__wbindgen_externrefs.set(e,t),e}function k(t,e){return t=t>>>0,g().subarray(t/1,t/1+e)}var l=null;function R(){return(l===null||l.buffer.detached===!0||l.buffer.detached===void 0&&l.buffer!==i.memory.buffer)&&(l=new DataView(i.memory.buffer)),l}function d(t,e){return t=t>>>0,$(t,e)}var p=null;function g(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(i.memory.buffer)),p}function P(t,e){try{return t.apply(this,e)}catch(n){let r=D(n);i.__wbindgen_exn_store(r)}}function h(t,e,n){if(n===void 0){let a=y.encode(t),c=e(a.length,1)>>>0;return g().subarray(c,c+a.length).set(a),u=a.length,c}let r=t.length,s=e(r,1)>>>0,_=g(),o=0;for(;o<r;o++){let a=t.charCodeAt(o);if(a>127)break;_[s+o]=a}if(o!==r){o!==0&&(t=t.slice(o)),s=n(s,r,r=o+t.length*3,1)>>>0;let a=g().subarray(s+o,s+r),c=y.encodeInto(t,a);o+=c.written,s=n(s,r,o,1)>>>0}return u=o,s}function b(t){let e=i.__wbindgen_externrefs.get(t);return i.__externref_table_dealloc(t),e}var x=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});x.decode();var V=2146435072,S=0;function $(t,e){return S+=e,S>=V&&(x=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),x.decode(),S=e),x.decode(g().subarray(t,t+e))}var y=new TextEncoder;"encodeInto"in y||(y.encodeInto=function(t,e){let n=y.encode(t);return e.set(n),{read:t.length,written:n.length}});var u=0,A=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>i.__wbg_wasmcompileresult_free(t>>>0,1)),w=class t{static __wrap(e){e=e>>>0;let n=Object.create(t.prototype);return n.__wbg_ptr=e,A.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,A.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_wasmcompileresult_free(e,0)}get binary(){let e=i.wasmcompileresult_binary(this.__wbg_ptr),n;return e[0]!==0&&(n=k(e[0],e[1]).slice(),i.__wbindgen_free(e[0],e[1]*1,1)),n}get errors(){return i.wasmcompileresult_errors(this.__wbg_ptr)}};Symbol.dispose&&(w.prototype[Symbol.dispose]=w.prototype.free);function N(t,e){let n=h(t,i.__wbindgen_malloc,i.__wbindgen_realloc),r=u,s=i.compile(n,r,e);return w.__wrap(s)}function B(t,e){i.free_memory(t,e)}function U(t,e,n){i.free_memory_with_len(t,e,n)}function L(t){let e=h(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,r=i.lexer(e,n);if(r[2])throw b(r[1]);return b(r[0])}function q(){i.main_init()}function X(t){let e=h(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,r=i.normalize(e,n);if(r[2])throw b(r[1]);return b(r[0])}function Y(t){let e=h(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,r=i.parser(e,n);if(r[2])throw b(r[1]);return b(r[0])}function H(){let t,e;try{let n=i.version();return t=n[0],e=n[1],d(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}var J=new Set(["basic","cors","default"]);async function G(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.ok&&J.has(t.type)&&t.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{let n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function z(){let t={};return t.wbg={},t.wbg.__wbg_Error_52673b7de5a0ca89=function(e,n){return Error(d(e,n))},t.wbg.__wbg___wbindgen_is_string_704ef9c8fc131030=function(e){return typeof e=="string"},t.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(e,n){throw new Error(d(e,n))},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,n){let r,s;try{r=e,s=n,console.error(d(e,n))}finally{i.__wbindgen_free(r,s,1)}},t.wbg.__wbg_getRandomValues_1c61fac11405ffdc=function(){return P(function(e,n){globalThis.crypto.getRandomValues(k(e,n))},arguments)},t.wbg.__wbg_new_1ba21ce319a06297=function(){return new Object},t.wbg.__wbg_new_25f239778d6112b9=function(){return new Array},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},t.wbg.__wbg_new_b546ae120718850e=function(){return new Map},t.wbg.__wbg_set_3f1d0b984ed272ed=function(e,n,r){e[n]=r},t.wbg.__wbg_set_7df433eea03a5c14=function(e,n,r){e[n>>>0]=r},t.wbg.__wbg_set_efaaf145b9377369=function(e,n,r){return e.set(n,r)},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,n){let r=n.stack,s=h(r,i.__wbindgen_malloc,i.__wbindgen_realloc),_=u;R().setInt32(e+4,_,!0),R().setInt32(e+0,s,!0)},t.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,n){return d(e,n)},t.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){return BigInt.asUintN(64,e)},t.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return e},t.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(e){return e},t.wbg.__wbindgen_init_externref_table=function(){let e=i.__wbindgen_externrefs,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},t}function F(t,e){return i=t.exports,T.__wbindgen_wasm_module=e,l=null,p=null,i.__wbindgen_start(),i}function K(t){if(i!==void 0)return i;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module:t}=t:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let e=z();t instanceof WebAssembly.Module||(t=new WebAssembly.Module(t));let n=new WebAssembly.Instance(t,e);return F(n,t)}async function T(t){if(i!==void 0)return i;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL("snowfall_core_bg.wasm",import.meta.url));let e=z();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));let{instance:n,module:r}=await G(await t,e);return F(n,r)}var E=T;var m=class extends Error{type;code;line;column;trace;context;constructor(e){super(e.message),this.name=this.constructor.name,this.type=e.type,this.code=e.code,this.line=e.line,this.column=e.column,this.trace=e.trace,this.context=e.context,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}};var f=class{static isDebug=!1;static prefix="SnowFall";static info(...e){this.isDebug&&console.log(`[${this.prefix}]`,...e)}static warn(...e){console.warn(`[${this.prefix}]`,...e)}static error(...e){console.error(`[${this.prefix}]`,...e)}};function I(t){let e=/^v?(\d+)\.(\d+)\.(\d+)$/.exec(t);return e?{major:Number(e[1]),minor:Number(e[2]),patch:Number(e[3])}:null}function W(t,e){return t.major!==e.major?{kind:"err",message:`MAJOR mismatch: ts=${t.major}, rust=${e.major}`}:t.minor!==e.minor?{kind:"err",message:`MINOR mismatch: ts=${t.minor}, rust=${e.minor}`}:t.patch!==e.patch?{kind:"warn",message:`PATCH mismatch: ts=${t.patch}, rust=${e.patch}`}:{kind:"ok"}}var M="v0.3.1";var O=class{_wasm=null;_isInitialized=!1;constructor(e=!1){f.isDebug=e}async init(e){if(!this._isInitialized){try{await E(e)}catch(n){throw f.error("Failed to initialize SnowFall Wasm module:",n),n}this._wasm=v,this._versionCheck(),this._isInitialized=!0,f.info("SnowFall Wasm module initialized successfully.")}}ensureInitialized(){if(!this._wasm||!this._isInitialized)throw new Error("SnowFall has not been initialized. Please call init() first.");return this._wasm}version(){return M}version_wasm(){return this.ensureInitialized().version()}compile_bin(e,n){let s=this.ensureInitialized().compile(e,n);try{let _=s.errors;if(_){let a=_;if(Array.isArray(a)&&a.length>0)return{errors:a.map(c=>new m(c))}}let o=s.binary;return o?{binary:o}:{}}finally{s.free()}}dev_lexer(e){return this.ensureInitialized().lexer(e)}dev_parser(e){let r=this.ensureInitialized().parser(e);return r.errors?{...r,errors:r.errors.map(s=>new m(s))}:r}dev_normalize(e){let r=this.ensureInitialized().normalize(e);return r.errors?{...r,errors:r.errors.map(s=>new m(s))}:r}_versionCheck(){if(!this._wasm)return;let e=I(this.version()),n=I(this._wasm.version());if(!e||!n)throw new Error("Invalid version format (expected x.y.z)");let r=W(e,n);switch(r.kind){case"ok":return;case"warn":f.warn("[Version]",r.message);return;case"err":throw new Error(`[Version] ${r.message}`)}}};export{O as SnowFall};
//# sourceMappingURL=snowfall.min.js.map
